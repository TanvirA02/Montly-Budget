<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #4e73df;
            --success-color: #1cc88a;
            --info-color: #36b9cc;
            --warning-color: #f6c23e;
            --danger-color: #e74a3b;
            --light-color: #f8f9fc;
            --dark-color: #5a5c69;
        }
        
        body {
            background-color: #f8f9fc;
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        .sidebar {
            min-height: 100vh;
            background-color: var(--primary-color);
            color: white;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 1rem;
            transition: all 0.3s;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .card {
            border: none;
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid #e3e6f0;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .stat-card {
            border-left: 0.25rem solid;
        }
        
        .income-card {
            border-left-color: var(--success-color);
        }
        
        .expense-card {
            border-left-color: var(--danger-color);
        }
        
        .balance-card {
            border-left-color: var(--info-color);
        }
        
        .form-control, .form-select {
            border-radius: 0.35rem;
            border: 1px solid #d1d3e2;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .table {
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .table thead th {
            border-top: none;
            border-bottom: 2px solid #e3e6f0;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .custom-toast {
            min-width: 300px;
        }
        
        .budget-category {
            border-left: 4px solid;
            padding-left: 15px;
            margin-bottom: 20px;
        }
        
        .mandatory-bills {
            border-left-color: #0052cc;
        }
        
        .living-essentials {
            border-left-color: #00a86b;
        }
        
        .category-title {
            font-weight: bold;
            color: #5a5c69;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4><i class="bi bi-wallet2"></i> Student Budget</h4>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-section="dashboard">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="income">
                                <i class="bi bi-cash-stack"></i> Income
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="expenses">
                                <i class="bi bi-receipt"></i> Expenses
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="reports">
                                <i class="bi bi-graph-up"></i> Reports
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="settings">
                                <i class="bi bi-gear"></i> Settings
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2" id="page-title">Dashboard</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="exportBtn">
                                <i class="bi bi-file-earmark-pdf"></i> Export Professional PDF
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Section -->
                <div id="dashboard" class="content-section active">
                    <div class="row">
                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card stat-card income-card">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                Monthly Income
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-income">$0.00</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-cash-stack fa-2x text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card stat-card expense-card">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                                Monthly Expenses
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-expenses">$0.00</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-receipt fa-2x text-danger"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card stat-card balance-card">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                Balance
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="balance">$0.00</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-wallet2 fa-2x text-info"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-pie-chart"></i> Expense Categories
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="expenseChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-bar-chart"></i> Income vs Expenses
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="incomeExpenseChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-clock-history"></i> Recent Transactions
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="recent-transactions">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Description</th>
                                                    <th>Category</th>
                                                    <th>Type</th>
                                                    <th>Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Transactions will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Income Section -->
                <div id="income" class="content-section">
                    <div class="row">
                        <div class="col-lg-5 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-plus-circle"></i> Add Income
                                </div>
                                <div class="card-body">
                                    <form id="income-form">
                                        <div class="mb-3">
                                            <label for="income-date" class="form-label">Date</label>
                                            <input type="date" class="form-control" id="income-date" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="income-source" class="form-label">Source</label>
                                            <select class="form-select" id="income-source" required>
                                                <option value="" selected disabled>Select income source</option>
                                                <option value="side-hustle-1">Side Hustle 1</option>
                                                <option value="side-hustle-2">Side Hustle 2</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="income-description" class="form-label">Description</label>
                                            <input type="text" class="form-control" id="income-description" placeholder="Enter description" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="income-amount" class="form-label">Amount ($)</label>
                                            <input type="number" class="form-control" id="income-amount" placeholder="0.00" step="0.01" min="0" required>
                                        </div>
                                        <button type="submit" class="btn btn-success">
                                            <i class="bi bi-check-circle"></i> Add Income
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-7 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-list-ul"></i> Income History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="income-table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Source</th>
                                                    <th>Description</th>
                                                    <th>Amount</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Income entries will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Expenses Section -->
                <div id="expenses" class="content-section">
                    <div class="row">
                        <div class="col-lg-5 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-plus-circle"></i> Add Expense
                                </div>
                                <div class="card-body">
                                    <form id="expense-form">
                                        <div class="mb-3">
                                            <label for="expense-date" class="form-label">Date</label>
                                            <input type="date" class="form-control" id="expense-date" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="expense-category" class="form-label">Category</label>
                                            <select class="form-select" id="expense-category" required>
                                                <option value="" selected disabled>Select expense category</option>
                                                <optgroup label="ðŸŸ¦ Mandatory Bills">
                                                    <option value="education">Education</option>
                                                    <option value="loan">Loan</option>
                                                    <option value="transport">Transport</option>
                                                </optgroup>
                                                <optgroup label="ðŸŸ© Living Essentials">
                                                    <option value="food">Food</option>
                                                    <option value="personal">Personal</option>
                                                    <option value="healthcare">Healthcare</option>
                                                </optgroup>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="expense-description" class="form-label">Description</label>
                                            <input type="text" class="form-control" id="expense-description" placeholder="Enter description" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="expense-amount" class="form-label">Amount ($)</label>
                                            <input type="number" class="form-control" id="expense-amount" placeholder="0.00" step="0.01" min="0" required>
                                        </div>
                                        <button type="submit" class="btn btn-danger">
                                            <i class="bi bi-check-circle"></i> Add Expense
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-7 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-list-ul"></i> Expense History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="expense-table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Category</th>
                                                    <th>Description</th>
                                                    <th>Amount</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Expense entries will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports" class="content-section">
                    <div class="row">
                        <div class="col-lg-12 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-calendar-month"></i> Monthly Report
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label for="report-month" class="form-label">Select Month</label>
                                            <select class="form-select" id="report-month">
                                                <option value="1">January</option>
                                                <option value="2">February</option>
                                                <option value="3">March</option>
                                                <option value="4">April</option>
                                                <option value="5">May</option>
                                                <option value="6">June</option>
                                                <option value="7">July</option>
                                                <option value="8">August</option>
                                                <option value="9">September</option>
                                                <option value="10">October</option>
                                                <option value="11">November</option>
                                                <option value="12">December</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="report-year" class="form-label">Select Year</label>
                                            <select class="form-select" id="report-year">
                                                <!-- Years will be populated dynamically -->
                                            </select>
                                        </div>
                                        <div class="col-md-4 d-flex align-items-end">
                                            <button type="button" class="btn btn-primary" id="generate-report">
                                                <i class="bi bi-arrow-repeat"></i> Generate Report
                                            </button>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="report-table">
                                            <thead>
                                                <tr>
                                                    <th>Category</th>
                                                    <th>Budget</th>
                                                    <th>Actual</th>
                                                    <th>Difference</th>
                                                    <th>Percentage</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Report data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings" class="content-section">
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-sliders"></i> Budget Settings
                                </div>
                                <div class="card-body">
                                    <form id="budget-form">
                                        <div class="budget-category mandatory-bills">
                                            <div class="category-title">ðŸŸ¦ Mandatory Bills</div>
                                            
                                            <div class="mb-3">
                                                <label for="education-budget" class="form-label">Education Budget ($)</label>
                                                <input type="number" class="form-control" id="education-budget" placeholder="0.00" step="0.01" min="0">
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="loan-budget" class="form-label">Loan Budget ($)</label>
                                                <input type="number" class="form-control" id="loan-budget" placeholder="0.00" step="0.01" min="0">
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="transport-budget" class="form-label">Transport Budget ($)</label>
                                                <input type="number" class="form-control" id="transport-budget" placeholder="0.00" step="0.01" min="0">
                                            </div>
                                        </div>
                                        
                                        <div class="budget-category living-essentials">
                                            <div class="category-title">ðŸŸ© Living Essentials</div>
                                            
                                            <div class="mb-3">
                                                <label for="food-budget" class="form-label">Food Budget ($)</label>
                                                <input type="number" class="form-control" id="food-budget" placeholder="0.00" step="0.01" min="0">
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="personal-budget" class="form-label">Personal Budget ($)</label>
                                                <input type="number" class="form-control" id="personal-budget" placeholder="0.00" step="0.01" min="0">
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="healthcare-budget" class="form-label">Healthcare Budget ($)</label>
                                                <input type="number" class="form-control" id="healthcare-budget" placeholder="0.00" step="0.01" min="0">
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="monthly-budget" class="form-label">Total Monthly Budget ($)</label>
                                            <input type="number" class="form-control" id="monthly-budget" placeholder="0.00" step="0.01" min="0" readonly>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-check-circle"></i> Save Budget Settings
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-person-circle"></i> Profile Settings
                                </div>
                                <div class="card-body">
                                    <form id="profile-form">
                                        <div class="mb-3">
                                            <label for="student-name" class="form-label">Student Name</label>
                                            <input type="text" class="form-control" id="student-name" placeholder="Enter your name">
                                        </div>
                                        <div class="mb-3">
                                            <label for="student-email" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="student-email" placeholder="Enter your email">
                                        </div>
                                        <div class="mb-3">
                                            <label for="side-hustle-1-name" class="form-label">Side Hustle 1 Name</label>
                                            <input type="text" class="form-control" id="side-hustle-1-name" placeholder="Enter side hustle name">
                                        </div>
                                        <div class="mb-3">
                                            <label for="side-hustle-2-name" class="form-label">Side Hustle 2 Name</label>
                                            <input type="text" class="form-control" id="side-hustle-2-name" placeholder="Enter side hustle name">
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-check-circle"></i> Save Profile
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-trash"></i> Data Management
                                </div>
                                <div class="card-body">
                                    <button type="button" class="btn btn-danger me-2" id="clear-data">
                                        <i class="bi bi-trash"></i> Clear All Data
                                    </button>
                                    <button type="button" class="btn btn-warning me-2" id="reset-budget">
                                        <i class="bi bi-arrow-clockwise"></i> Reset Budget
                                    </button>
                                    <button type="button" class="btn btn-info" id="import-data">
                                        <i class="bi bi-upload"></i> Import Data
                                    </button>
                                    <input type="file" id="import-file" accept=".json" style="display: none;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date for date inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('income-date').value = today;
            document.getElementById('expense-date').value = today;
            
            // Initialize the current month and year for reports
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            document.getElementById('report-month').value = currentMonth;
            
            // Populate year dropdown
            const yearSelect = document.getElementById('report-year');
            for (let year = currentYear - 5; year <= currentYear + 5; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
            
            // Initialize data
            initializeData();
            
            // Load data from localStorage
            loadData();
            
            // Update UI
            updateDashboard();
            updateIncomeTable();
            updateExpenseTable();
            updateCharts();
            updateRecentTransactions();
            loadSettings();
            
            // Setup event listeners
            setupEventListeners();
        });
        
        // Initialize data structure
        function initializeData() {
            if (!localStorage.getItem('studentBudgetData')) {
                const initialData = {
                    income: [],
                    expenses: [],
                    budgets: {
                        monthly: 13000,
                        education: 6000,
                        loan: 3000,
                        transport: 2700,
                        food: 1000,
                        personal: 200,
                        healthcare: 100
                    },
                    profile: {
                        name: 'Student',
                        email: 'student@example.com',
                        sideHustle1: 'Side Hustle 1',
                        sideHustle2: 'Side Hustle 2'
                    }
                };
                localStorage.setItem('studentBudgetData', JSON.stringify(initialData));
            }
        }
        
        // Load data from localStorage
        function loadData() {
            window.budgetData = JSON.parse(localStorage.getItem('studentBudgetData'));
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('studentBudgetData', JSON.stringify(window.budgetData));
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                    
                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Update page title
                    document.getElementById('page-title').textContent = 
                        section.charAt(0).toUpperCase() + section.slice(1);
                });
            });
            
            // Income form
            document.getElementById('income-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addIncome();
            });
            
            // Expense form
            document.getElementById('expense-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addExpense();
            });
            
            // Budget form
            document.getElementById('budget-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveBudgetSettings();
            });
            
            // Profile form
            document.getElementById('profile-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveProfileSettings();
            });
            
            // Generate report
            document.getElementById('generate-report').addEventListener('click', function() {
                generateReport();
            });
            
            // Export PDF
            document.getElementById('exportBtn').addEventListener('click', function() {
                exportProfessionalPDF();
            });
            
            // Clear data
            document.getElementById('clear-data').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                    clearAllData();
                }
            });
            
            // Reset budget
            document.getElementById('reset-budget').addEventListener('click', function() {
                if (confirm('Are you sure you want to reset budget settings to default?')) {
                    resetBudget();
                }
            });
            
            // Import data
            document.getElementById('import-data').addEventListener('click', function() {
                document.getElementById('import-file').click();
            });
            
            document.getElementById('import-file').addEventListener('change', function(e) {
                importData(e.target.files[0]);
            });
            
            // Update total budget when individual budgets change
            const budgetInputs = ['education-budget', 'loan-budget', 'transport-budget', 'food-budget', 'personal-budget', 'healthcare-budget'];
            budgetInputs.forEach(id => {
                document.getElementById(id).addEventListener('input', updateTotalBudget);
            });
        }
        
        // Update total budget
        function updateTotalBudget() {
            const budgets = ['education', 'loan', 'transport', 'food', 'personal', 'healthcare'];
            let total = 0;
            budgets.forEach(budget => {
                const value = parseFloat(document.getElementById(`${budget}-budget`).value) || 0;
                total += value;
            });
            document.getElementById('monthly-budget').value = total.toFixed(2);
        }
        
        // Show section
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }
        
        // Add income
        function addIncome() {
            const date = document.getElementById('income-date').value;
            const source = document.getElementById('income-source').value;
            const description = document.getElementById('income-description').value;
            const amount = parseFloat(document.getElementById('income-amount').value);
            
            const incomeEntry = {
                id: Date.now(),
                date,
                source,
                description,
                amount
            };
            
            window.budgetData.income.push(incomeEntry);
            saveData();
            
            // Reset form
            document.getElementById('income-form').reset();
            document.getElementById('income-date').value = new Date().toISOString().split('T')[0];
            
            // Update UI
            updateDashboard();
            updateIncomeTable();
            updateCharts();
            updateRecentTransactions();
            
            // Show success message
            showToast('Income added successfully!', 'success');
        }
        
        // Add expense
        function addExpense() {
            const date = document.getElementById('expense-date').value;
            const category = document.getElementById('expense-category').value;
            const description = document.getElementById('expense-description').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            
            const expenseEntry = {
                id: Date.now(),
                date,
                category,
                description,
                amount
            };
            
            window.budgetData.expenses.push(expenseEntry);
            saveData();
            
            // Reset form
            document.getElementById('expense-form').reset();
            document.getElementById('expense-date').value = new Date().toISOString().split('T')[0];
            
            // Update UI
            updateDashboard();
            updateExpenseTable();
            updateCharts();
            updateRecentTransactions();
            
            // Show success message
            showToast('Expense added successfully!', 'danger');
        }
        
        // Delete income
        function deleteIncome(id) {
            if (confirm('Are you sure you want to delete this income entry?')) {
                window.budgetData.income = window.budgetData.income.filter(item => item.id !== id);
                saveData();
                updateDashboard();
                updateIncomeTable();
                updateCharts();
                updateRecentTransactions();
                showToast('Income entry deleted!', 'warning');
            }
        }
        
        // Delete expense
        function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this expense entry?')) {
                window.budgetData.expenses = window.budgetData.expenses.filter(item => item.id !== id);
                saveData();
                updateDashboard();
                updateExpenseTable();
                updateCharts();
                updateRecentTransactions();
                showToast('Expense entry deleted!', 'warning');
            }
        }
        
        // Update dashboard
        function updateDashboard() {
            // Calculate totals
            const totalIncome = window.budgetData.income.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = window.budgetData.expenses.reduce((sum, item) => sum + item.amount, 0);
            const balance = totalIncome - totalExpenses;
            
            // Update UI
            document.getElementById('total-income').textContent = `$${totalIncome.toFixed(2)}`;
            document.getElementById('total-expenses').textContent = `$${totalExpenses.toFixed(2)}`;
            document.getElementById('balance').textContent = `$${balance.toFixed(2)}`;
            
            // Update balance color based on value
            const balanceElement = document.getElementById('balance');
            if (balance < 0) {
                balanceElement.style.color = '#e74a3b';
            } else if (balance < 100) {
                balanceElement.style.color = '#f6c23e';
            } else {
                balanceElement.style.color = '#1cc88a';
            }
        }
        
        // Update income table
        function updateIncomeTable() {
            const tableBody = document.querySelector('#income-table tbody');
            tableBody.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedIncome = [...window.budgetData.income].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedIncome.forEach(item => {
                const row = document.createElement('tr');
                
                // Format source name
                let sourceName = item.source;
                if (item.source === 'side-hustle-1') {
                    sourceName = window.budgetData.profile.sideHustle1;
                } else if (item.source === 'side-hustle-2') {
                    sourceName = window.budgetData.profile.sideHustle2;
                }
                
                row.innerHTML = `
                    <td>${formatDate(item.date)}</td>
                    <td>${sourceName}</td>
                    <td>${item.description}</td>
                    <td>$${item.amount.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteIncome(${item.id})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Update expense table
        function updateExpenseTable() {
            const tableBody = document.querySelector('#expense-table tbody');
            tableBody.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedExpenses = [...window.budgetData.expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedExpenses.forEach(item => {
                const row = document.createElement('tr');
                
                // Format category with icon
                let categoryDisplay = item.category.charAt(0).toUpperCase() + item.category.slice(1);
                const mandatoryCategories = ['education', 'loan', 'transport'];
                const icon = mandatoryCategories.includes(item.category) ? 'ðŸŸ¦' : 'ðŸŸ©';
                
                row.innerHTML = `
                    <td>${formatDate(item.date)}</td>
                    <td>${icon} ${categoryDisplay}</td>
                    <td>${item.description}</td>
                    <td>$${item.amount.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteExpense(${item.id})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Update recent transactions
        function updateRecentTransactions() {
            const tableBody = document.querySelector('#recent-transactions tbody');
            tableBody.innerHTML = '';
            
            // Combine and sort all transactions
            const allTransactions = [
                ...window.budgetData.income.map(item => ({...item, type: 'income'})),
                ...window.budgetData.expenses.map(item => ({...item, type: 'expense'}))
            ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10); // Get latest 10
            
            allTransactions.forEach(item => {
                const row = document.createElement('tr');
                
                let category = item.category || item.source;
                if (item.source === 'side-hustle-1') {
                    category = window.budgetData.profile.sideHustle1;
                } else if (item.source === 'side-hustle-2') {
                    category = window.budgetData.profile.sideHustle2;
                } else if (item.category) {
                    const mandatoryCategories = ['education', 'loan', 'transport'];
                    const icon = mandatoryCategories.includes(item.category) ? 'ðŸŸ¦' : 'ðŸŸ©';
                    category = `${icon} ${item.category.charAt(0).toUpperCase() + item.category.slice(1)}`;
                }
                
                const typeBadge = item.type === 'income' 
                    ? '<span class="badge bg-success">Income</span>' 
                    : '<span class="badge bg-danger">Expense</span>';
                
                row.innerHTML = `
                    <td>${formatDate(item.date)}</td>
                    <td>${item.description}</td>
                    <td>${category}</td>
                    <td>${typeBadge}</td>
                    <td class="${item.type === 'income' ? 'text-success' : 'text-danger'}">
                        ${item.type === 'income' ? '+' : '-'}$${item.amount.toFixed(2)}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Update charts
        function updateCharts() {
            // Expense categories chart
            const expenseCategories = {};
            window.budgetData.expenses.forEach(item => {
                if (!expenseCategories[item.category]) {
                    expenseCategories[item.category] = 0;
                }
                expenseCategories[item.category] += item.amount;
            });
            
            const expenseCtx = document.getElementById('expenseChart').getContext('2d');
            if (window.expenseChartInstance) {
                window.expenseChartInstance.destroy();
            }
            window.expenseChartInstance = new Chart(expenseCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(expenseCategories).map(key => {
                        const displayName = key.charAt(0).toUpperCase() + key.slice(1);
                        const mandatoryCategories = ['education', 'loan', 'transport'];
                        const icon = mandatoryCategories.includes(key) ? 'ðŸŸ¦' : 'ðŸŸ©';
                        return `${icon} ${displayName}`;
                    }),
                    datasets: [{
                        data: Object.values(expenseCategories),
                        backgroundColor: [
                            '#0052cc', // Education - Blue
                            '#0066ff', // Loan - Blue
                            '#3385ff', // Transport - Blue
                            '#00a86b', // Food - Green
                            '#00d4aa', // Personal - Green
                            '#7dd8c0'  // Healthcare - Green
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Income vs Expenses chart
            const incomeByMonth = {};
            const expensesByMonth = {};
            
            // Process income data
            window.budgetData.income.forEach(item => {
                const month = item.date.substring(0, 7); // YYYY-MM
                if (!incomeByMonth[month]) {
                    incomeByMonth[month] = 0;
                }
                incomeByMonth[month] += item.amount;
            });
            
            // Process expense data
            window.budgetData.expenses.forEach(item => {
                const month = item.date.substring(0, 7); // YYYY-MM
                if (!expensesByMonth[month]) {
                    expensesByMonth[month] = 0;
                }
                expensesByMonth[month] += item.amount;
            });
            
            // Get all months and sort them
            const allMonths = [...new Set([...Object.keys(incomeByMonth), ...Object.keys(expensesByMonth)])].sort();
            
            const incomeExpenseCtx = document.getElementById('incomeExpenseChart').getContext('2d');
            if (window.incomeExpenseChartInstance) {
                window.incomeExpenseChartInstance.destroy();
            }
            window.incomeExpenseChartInstance = new Chart(incomeExpenseCtx, {
                type: 'bar',
                data: {
                    labels: allMonths.map(month => {
                        const [year, monthNum] = month.split('-');
                        const monthName = new Date(year, monthNum - 1, 1).toLocaleDateString('en-US', { month: 'short' });
                        return `${monthName} ${year}`;
                    }),
                    datasets: [
                        {
                            label: 'Income',
                            data: allMonths.map(month => incomeByMonth[month] || 0),
                            backgroundColor: 'rgba(28, 200, 138, 0.7)',
                            borderColor: 'rgba(28, 200, 138, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Expenses',
                            data: allMonths.map(month => expensesByMonth[month] || 0),
                            backgroundColor: 'rgba(231, 74, 59, 0.7)',
                            borderColor: 'rgba(231, 74, 59, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        }
        
        // Generate report
        function generateReport() {
            const month = document.getElementById('report-month').value;
            const year = document.getElementById('report-year').value;
            
            // Filter expenses for the selected month and year
            const filteredExpenses = window.budgetData.expenses.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate.getMonth() + 1 === parseInt(month) && itemDate.getFullYear() === parseInt(year);
            });
            
            // Calculate expenses by category
            const expensesByCategory = {};
            filteredExpenses.forEach(item => {
                if (!expensesByCategory[item.category]) {
                    expensesByCategory[item.category] = 0;
                }
                expensesByCategory[item.category] += item.amount;
            });
            
            // Generate report table
            const tableBody = document.querySelector('#report-table tbody');
            tableBody.innerHTML = '';
            
            let totalBudget = 0;
            let totalActual = 0;
            
            // Add rows for each category
            Object.keys(window.budgetData.budgets).forEach(category => {
                if (category === 'monthly') return; // Skip the monthly budget
                
                const budget = window.budgetData.budgets[category];
                const actual = expensesByCategory[category] || 0;
                const difference = budget - actual;
                const percentage = budget > 0 ? (actual / budget * 100).toFixed(1) : 0;
                
                totalBudget += budget;
                totalActual += actual;
                
                const mandatoryCategories = ['education', 'loan', 'transport'];
                const icon = mandatoryCategories.includes(category) ? 'ðŸŸ¦' : 'ðŸŸ©';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${icon} ${category.charAt(0).toUpperCase() + category.slice(1)}</td>
                    <td>$${budget.toFixed(2)}</td>
                    <td>$${actual.toFixed(2)}</td>
                    <td class="${difference >= 0 ? 'text-success' : 'text-danger'}">
                        ${difference >= 0 ? '+' : ''}$${difference.toFixed(2)}
                    </td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar ${percentage > 100 ? 'bg-danger' : percentage > 80 ? 'bg-warning' : 'bg-success'}" 
                                role="progressbar" style="width: ${Math.min(percentage, 100)}%" 
                                aria-valuenow="${percentage}" aria-valuemin="0" aria-valuemax="100">
                                ${percentage}%
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add total row
            const totalRow = document.createElement('tr');
            totalRow.innerHTML = `
                <td><strong>Total</strong></td>
                <td><strong>$${totalBudget.toFixed(2)}</strong></td>
                <td><strong>$${totalActual.toFixed(2)}</strong></td>
                <td class="${totalBudget - totalActual >= 0 ? 'text-success' : 'text-danger'}">
                    <strong>${totalBudget - totalActual >= 0 ? '+' : ''}$${(totalBudget - totalActual).toFixed(2)}</strong>
                </td>
                <td>
                    <div class="progress">
                        <div class="progress-bar ${totalActual > totalBudget ? 'bg-danger' : totalActual > totalBudget * 0.8 ? 'bg-warning' : 'bg-success'}" 
                            role="progressbar" style="width: ${Math.min(totalActual / totalBudget * 100, 100)}%" 
                            aria-valuenow="${totalActual / totalBudget * 100}" aria-valuemin="0" aria-valuemax="100">
                            ${(totalActual / totalBudget * 100).toFixed(1)}%
                        </div>
                    </div>
                </td>
            `;
            tableBody.appendChild(totalRow);
            
            showToast('Report generated successfully!', 'info');
        }
        
        // Export Professional PDF
        function exportProfessionalPDF() {
            showToast('Generating professional PDF report...', 'info');
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            // Get current month and year
            const month = document.getElementById('report-month').value;
            const year = document.getElementById('report-year').value;
            const monthName = new Date(year, month - 1, 1).toLocaleDateString('en-US', { month: 'long' });
            
            // Calculate totals
            const totalIncome = window.budgetData.income.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = window.budgetData.expenses.reduce((sum, item) => sum + item.amount, 0);
            const balance = totalIncome - totalExpenses;
            
            // Filter data for selected month
            const filteredExpenses = window.budgetData.expenses.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate.getMonth() + 1 === parseInt(month) && itemDate.getFullYear() === parseInt(year);
            });
            
            const filteredIncome = window.budgetData.income.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate.getMonth() + 1 === parseInt(month) && itemDate.getFullYear() === parseInt(year);
            });
            
            // Calculate expenses by category
            const expensesByCategory = {};
            filteredExpenses.forEach(item => {
                if (!expensesByCategory[item.category]) {
                    expensesByCategory[item.category] = 0;
                }
                expensesByCategory[item.category] += item.amount;
            });
            
            // Calculate income by source
            const incomeBySource = {};
            filteredIncome.forEach(item => {
                let sourceName = item.source;
                if (item.source === 'side-hustle-1') {
                    sourceName = window.budgetData.profile.sideHustle1;
                } else if (item.source === 'side-hustle-2') {
                    sourceName = window.budgetData.profile.sideHustle2;
                }
                
                if (!incomeBySource[sourceName]) {
                    incomeBySource[sourceName] = 0;
                }
                incomeBySource[sourceName] += item.amount;
            });
            
            // Page dimensions
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const margin = 20;
            const contentWidth = pageWidth - 2 * margin;
            
            // Add custom font for better appearance
            pdf.setFont('helvetica');
            
            // Header
            pdf.setFillColor(78, 115, 223);
            pdf.rect(0, 0, pageWidth, 40, 'F');
            
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(24);
            pdf.text('FINANCIAL REPORT', pageWidth / 2, 25, { align: 'center' });
            
            pdf.setFontSize(12);
            pdf.text('Student Budget Management System', pageWidth / 2, 33, { align: 'center' });
            
            // Report info box
            pdf.setFillColor(240, 240, 240);
            pdf.rect(margin, 50, contentWidth, 30, 'F');
            pdf.setDrawColor(200, 200, 200);
            pdf.rect(margin, 50, contentWidth, 30);
            
            pdf.setTextColor(0, 0, 0);
            pdf.setFontSize(12);
            pdf.setFont('helvetica', 'bold');
            pdf.text(`Report Period: ${monthName} ${year}`, margin + 5, 60);
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Student: ${window.budgetData.profile.name}`, margin + 5, 70);
            pdf.text(`Generated: ${new Date().toLocaleDateString()}`, margin + 120, 70);
            
            // Executive Summary Section
            pdf.setTextColor(0, 0, 0);
            pdf.setFontSize(16);
            pdf.setFont('helvetica', 'bold');
            pdf.text('EXECUTIVE SUMMARY', margin, 100);
            
            pdf.setDrawColor(200, 200, 200);
            pdf.line(margin, 105, margin + contentWidth, 105);
            
            // Summary cards
            const cardY = 115;
            const cardWidth = contentWidth / 3 - 10;
            
            // Income Card
            pdf.setFillColor(28, 200, 138);
            pdf.rect(margin, cardY, cardWidth, 40, 'F');
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.text('TOTAL INCOME', margin + cardWidth/2, cardY + 15, { align: 'center' });
            pdf.setFontSize(14);
            pdf.text(`$${totalIncome.toFixed(2)}`, margin + cardWidth/2, cardY + 30, { align: 'center' });
            
            // Expenses Card
            pdf.setFillColor(231, 74, 59);
            pdf.rect(margin + cardWidth + 10, cardY, cardWidth, 40, 'F');
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.text('TOTAL EXPENSES', margin + cardWidth + 10 + cardWidth/2, cardY + 15, { align: 'center' });
            pdf.setFontSize(14);
            pdf.text(`$${totalExpenses.toFixed(2)}`, margin + cardWidth + 10 + cardWidth/2, cardY + 30, { align: 'center' });
            
            // Balance Card
            const balanceColor = balance >= 0 ? [28, 200, 138] : [231, 74, 59];
            pdf.setFillColor(...balanceColor);
            pdf.rect(margin + 2 * (cardWidth + 10), cardY, cardWidth, 40, 'F');
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.text('NET BALANCE', margin + 2 * (cardWidth + 10) + cardWidth/2, cardY + 15, { align: 'center' });
            pdf.setFontSize(14);
            pdf.text(`$${balance.toFixed(2)}`, margin + 2 * (cardWidth + 10) + cardWidth/2, cardY + 30, { align: 'center' });
            
            // Expense Breakdown Table
            let currentY = 170;
            pdf.setTextColor(0, 0, 0);
            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'bold');
            pdf.text('EXPENSE BREAKDOWN', margin, currentY);
            
            pdf.setDrawColor(200, 200, 200);
            pdf.line(margin, currentY + 5, margin + contentWidth, currentY + 5);
            currentY += 15;
            
            // Table headers
            const headers = ['Category', 'Budget', 'Actual', 'Variance', '% Used'];
            const colWidths = [50, 40, 40, 40, 30];
            let currentX = margin;
            
            pdf.setFillColor(78, 115, 223);
            pdf.rect(margin, currentY, contentWidth, 10, 'F');
            
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(9);
            pdf.setFont('helvetica', 'bold');
            
            headers.forEach((header, i) => {
                pdf.text(header, currentX + 2, currentY + 7);
                currentX += colWidths[i];
            });
            
            currentY += 10;
            
            // Table data
            let totalBudget = 0;
            let totalActual = 0;
            
            // Mandatory Bills section
            pdf.setTextColor(0, 0, 0);
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.text('ðŸŸ¦ Mandatory Bills', margin + 2, currentY + 6);
            currentY += 8;
            
            const mandatoryCategories = ['education', 'loan', 'transport'];
            mandatoryCategories.forEach(category => {
                const budget = window.budgetData.budgets[category];
                const actual = expensesByCategory[category] || 0;
                const variance = budget - actual;
                const percentage = budget > 0 ? (actual / budget * 100).toFixed(1) : 0;
                
                totalBudget += budget;
                totalActual += actual;
                
                currentX = margin;
                
                // Alternate row colors
                pdf.setFillColor(245, 245, 245);
                pdf.rect(margin, currentY, contentWidth, 8, 'F');
                
                pdf.setTextColor(0, 0, 0);
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                
                pdf.text(category.charAt(0).toUpperCase() + category.slice(1), currentX + 2, currentY + 6);
                currentX += colWidths[0];
                
                pdf.text(`$${budget.toFixed(2)}`, currentX + 2, currentY + 6);
                currentX += colWidths[1];
                
                pdf.text(`$${actual.toFixed(2)}`, currentX + 2, currentY + 6);
                currentX += colWidths[2];
                
                const varianceColor = variance >= 0 ? [28, 200, 138] : [231, 74, 59];
                pdf.setTextColor(...varianceColor);
                pdf.text(`${variance >= 0 ? '+' : ''}$${variance.toFixed(2)}`, currentX + 2, currentY + 6);
                currentX += colWidths[3];
                
                const percentColor = percentage > 100 ? [231, 74, 59] : percentage > 80 ? [246, 194, 62] : [28, 200, 138];
                pdf.setTextColor(...percentColor);
                pdf.text(`${percentage}%`, currentX + 2, currentY + 6);
                
                currentY += 8;
            });
            
            // Living Essentials section
            currentY += 5;
            pdf.setTextColor(0, 0, 0);
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.text('ðŸŸ© Living Essentials', margin + 2, currentY + 6);
            currentY += 8;
            
            const livingCategories = ['food', 'personal', 'healthcare'];
            livingCategories.forEach(category => {
                const budget = window.budgetData.budgets[category];
                const actual = expensesByCategory[category] || 0;
                const variance = budget - actual;
                const percentage = budget > 0 ? (actual / budget * 100).toFixed(1) : 0;
                
                totalBudget += budget;
                totalActual += actual;
                
                currentX = margin;
                
                // Alternate row colors
                pdf.setFillColor(245, 245, 245);
                pdf.rect(margin, currentY, contentWidth, 8, 'F');
                
                pdf.setTextColor(0, 0, 0);
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                
                pdf.text(category.charAt(0).toUpperCase() + category.slice(1), currentX + 2, currentY + 6);
                currentX += colWidths[0];
                
                pdf.text(`$${budget.toFixed(2)}`, currentX + 2, currentY + 6);
                currentX += colWidths[1];
                
                pdf.text(`$${actual.toFixed(2)}`, currentX + 2, currentY + 6);
                currentX += colWidths[2];
                
                const varianceColor = variance >= 0 ? [28, 200, 138] : [231, 74, 59];
                pdf.setTextColor(...varianceColor);
                pdf.text(`${variance >= 0 ? '+' : ''}$${variance.toFixed(2)}`, currentX + 2, currentY + 6);
                currentX += colWidths[3];
                
                const percentColor = percentage > 100 ? [231, 74, 59] : percentage > 80 ? [246, 194, 62] : [28, 200, 138];
                pdf.setTextColor(...percentColor);
                pdf.text(`${percentage}%`, currentX + 2, currentY + 6);
                
                currentY += 8;
            });
            
            // Total row
            pdf.setFillColor(220, 220, 220);
            pdf.rect(margin, currentY, contentWidth, 10, 'F');
            pdf.setDrawColor(150, 150, 150);
            pdf.rect(margin, currentY, contentWidth, 10);
            
            currentX = margin;
            pdf.setTextColor(0, 0, 0);
            pdf.setFontSize(9);
            pdf.setFont('helvetica', 'bold');
            
            pdf.text('TOTAL', currentX + 2, currentY + 7);
            currentX += colWidths[0];
            
            pdf.text(`$${totalBudget.toFixed(2)}`, currentX + 2, currentY + 7);
            currentX += colWidths[1];
            
            pdf.text(`$${totalActual.toFixed(2)}`, currentX + 2, currentY + 7);
            currentX += colWidths[2];
            
            const totalVariance = totalBudget - totalActual;
            const totalVarianceColor = totalVariance >= 0 ? [28, 200, 138] : [231, 74, 59];
            pdf.setTextColor(...totalVarianceColor);
            pdf.text(`${totalVariance >= 0 ? '+' : ''}$${totalVariance.toFixed(2)}`, currentX + 2, currentY + 7);
            currentX += colWidths[3];
            
            const totalPercentage = totalBudget > 0 ? (totalActual / totalBudget * 100).toFixed(1) : 0;
            const totalPercentColor = totalPercentage > 100 ? [231, 74, 59] : totalPercentage > 80 ? [246, 194, 62] : [28, 200, 138];
            pdf.setTextColor(...totalPercentColor);
            pdf.text(`${totalPercentage}%`, currentX + 2, currentY + 7);
            
            // Income Sources Section
            currentY += 20;
            if (currentY > pageHeight - 50) {
                pdf.addPage();
                currentY = 30;
            }
            
            pdf.setTextColor(0, 0, 0);
            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'bold');
            pdf.text('INCOME SOURCES', margin, currentY);
            
            pdf.setDrawColor(200, 200, 200);
            pdf.line(margin, currentY + 5, margin + contentWidth, currentY + 5);
            currentY += 15;
            
            // Income table headers
            const incomeHeaders = ['Source', 'Amount'];
            const incomeColWidths = [100, 50];
            currentX = margin;
            
            pdf.setFillColor(78, 115, 223);
            pdf.rect(margin, currentY, contentWidth, 10, 'F');
            
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(9);
            pdf.setFont('helvetica', 'bold');
            
            incomeHeaders.forEach((header, i) => {
                pdf.text(header, currentX + 2, currentY + 7);
                currentX += incomeColWidths[i];
            });
            
            currentY += 10;
            
            // Income table data
            Object.keys(incomeBySource).forEach(source => {
                currentX = margin;
                
                // Alternate row colors
                pdf.setFillColor(245, 245, 245);
                pdf.rect(margin, currentY, contentWidth, 8, 'F');
                
                pdf.setTextColor(0, 0, 0);
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                
                pdf.text(source, currentX + 2, currentY + 6);
                currentX += incomeColWidths[0];
                
                pdf.text(`$${incomeBySource[source].toFixed(2)}`, currentX + 2, currentY + 6);
                
                currentY += 8;
            });
            
            // Add footer
            const footerY = pageHeight - 20;
            pdf.setDrawColor(200, 200, 200);
            pdf.line(margin, footerY, margin + contentWidth, footerY);
            
            pdf.setTextColor(100, 100, 100);
            pdf.setFontSize(8);
            pdf.setFont('helvetica', 'italic');
            pdf.text('This is a computer-generated document and does not require a signature.', pageWidth / 2, footerY + 10, { align: 'center' });
            
            // Save PDF
            const fileName = `expense-report-${monthName.toLowerCase()}-${year}.pdf`;
            pdf.save(fileName);
            
            showToast('PDF report downloaded successfully!', 'success');
        }
        
        // Load settings
        function loadSettings() {
            // Load budget settings
            Object.keys(window.budgetData.budgets).forEach(key => {
                const input = document.getElementById(`${key}-budget`);
                if (input) {
                    input.value = window.budgetData.budgets[key];
                }
            });
            
            // Update total budget
            updateTotalBudget();
            
            // Load profile settings
            document.getElementById('student-name').value = window.budgetData.profile.name;
            document.getElementById('student-email').value = window.budgetData.profile.email;
            document.getElementById('side-hustle-1-name').value = window.budgetData.profile.sideHustle1;
            document.getElementById('side-hustle-2-name').value = window.budgetData.profile.sideHustle2;
            
            // Update income source dropdowns
            const incomeSourceSelect = document.getElementById('income-source');
            incomeSourceSelect.innerHTML = `
                <option value="" selected disabled>Select income source</option>
                <option value="side-hustle-1">${window.budgetData.profile.sideHustle1}</option>
                <option value="side-hustle-2">${window.budgetData.profile.sideHustle2}</option>
                <option value="other">Other</option>
            `;
        }
        
        // Save budget settings
        function saveBudgetSettings() {
            Object.keys(window.budgetData.budgets).forEach(key => {
                const input = document.getElementById(`${key}-budget`);
                if (input) {
                    window.budgetData.budgets[key] = parseFloat(input.value) || 0;
                }
            });
            
            saveData();
            showToast('Budget settings saved successfully!', 'success');
        }
        
        // Save profile settings
        function saveProfileSettings() {
            window.budgetData.profile.name = document.getElementById('student-name').value;
            window.budgetData.profile.email = document.getElementById('student-email').value;
            window.budgetData.profile.sideHustle1 = document.getElementById('side-hustle-1-name').value;
            window.budgetData.profile.sideHustle2 = document.getElementById('side-hustle-2-name').value;
            
            saveData();
            loadSettings(); // Reload to update dropdowns
            updateIncomeTable();
            updateRecentTransactions();
            showToast('Profile settings saved successfully!', 'success');
        }
        
        // Import data
        function importData(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (!importedData.income || !importedData.expenses || !importedData.budgets || !importedData.profile) {
                        throw new Error('Invalid data format');
                    }
                    
                    // Replace current data with imported data
                    window.budgetData = importedData;
                    saveData();
                    
                    // Update UI
                    updateDashboard();
                    updateIncomeTable();
                    updateExpenseTable();
                    updateCharts();
                    updateRecentTransactions();
                    loadSettings();
                    
                    showToast('Data imported successfully!', 'success');
                } catch (error) {
                    showToast('Error importing data: ' + error.message, 'danger');
                }
            };
            
            reader.readAsText(file);
        }
        
        // Clear all data
        function clearAllData() {
            initializeData();
            loadData();
            updateDashboard();
            updateIncomeTable();
            updateExpenseTable();
            updateCharts();
            updateRecentTransactions();
            loadSettings();
            showToast('All data cleared!', 'warning');
        }
        
        // Reset budget
        function resetBudget() {
            const defaultBudgets = {
                monthly: 13000,
                education: 6000,
                loan: 3000,
                transport: 2700,
                food: 1000,
                personal: 200,
                healthcare: 100
            };
            
            window.budgetData.budgets = defaultBudgets;
            saveData();
            loadSettings();
            showToast('Budget reset to default values!', 'warning');
        }
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        // Show toast notification
        function showToast(message, type) {
            const toastContainer = document.querySelector('.toast-container');
            const toastId = 'toast-' + Date.now();
            
            const toastHtml = `
                <div id="${toastId}" class="toast custom-toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, {
                autohide: true,
                delay: 3000
            });
            
            toast.show();
            
            toastElement.addEventListener('hidden.bs.toast', function() {
                toastElement.remove();
            });
        }
    </script>
</body>
</html>